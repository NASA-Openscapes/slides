<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.2.360">
  <meta name="author" content="Amy Steiker, NASA National Snow and Ice Data Center DAAC">
  <title>NASA Earthdata Access in the Cloud Using Open-source libraries</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="Earthdata_Cloud__Open-Science-Tutorial_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="Earthdata_Cloud__Open-Science-Tutorial_files/libs/revealjs/dist/reveal.css">
  <style>
    .reveal .sourceCode {  /* see #7635 */
      overflow: visible;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="Earthdata_Cloud__Open-Science-Tutorial_files/libs/revealjs/dist/theme/quarto.css" id="theme">

  <script src="Earthdata_Cloud__Open-Science-Tutorial_files/libs/clipboard/clipboard.min.js"></script>
  <script src="Earthdata_Cloud__Open-Science-Tutorial_files/libs/quarto-html/tabby.min.js"></script>
  <script src="Earthdata_Cloud__Open-Science-Tutorial_files/libs/quarto-html/popper.min.js"></script>
  <script src="Earthdata_Cloud__Open-Science-Tutorial_files/libs/quarto-html/tippy.umd.min.js"></script>
  <link href="Earthdata_Cloud__Open-Science-Tutorial_files/libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="Earthdata_Cloud__Open-Science-Tutorial_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet">
  <link href="Earthdata_Cloud__Open-Science-Tutorial_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <link href="Earthdata_Cloud__Open-Science-Tutorial_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="Earthdata_Cloud__Open-Science-Tutorial_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="Earthdata_Cloud__Open-Science-Tutorial_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="Earthdata_Cloud__Open-Science-Tutorial_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal-references {
      display: none;
    }
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide figure > figcaption {
      font-size: 0.5em
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
  <script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="center">
  <h1 class="title">NASA Earthdata Access in the Cloud Using Open-source libraries</h1>
  <p class="author">Amy Steiker, NASA National Snow and Ice Data Center DAAC</p>
</section>

<section class="slide level2">

</section>
<section class="slide level2">

<p><img src="images/nasa-earthdata-openscapes.png" align="right" width="400px"></p>
<h3 id="contributing-co-authors">Contributing co-authors</h3>
<p><br clear="right"></p>
<p><font size="5"></font></p><font size="5">
<p>Catalina M Oaida; NASA PO.DAAC, NASA JPL</p>
<p>Luis Alberto Lopez; NASA National Snow and Ice Data Center DAAC</p>
<p>Aaron Friesz; NASA Land Processes DAAC</p>
<p>Andrew P Barrett; NASA National Snow and Ice Data Center DAAC</p>
<p>Makhan Virdi; NASA ASDC DAAC</p>
<p>Jack McNelis; NASA PO.DAAC, NASA JPL</p>
<p>Julia Lowndes; Openscapes, NCEAS</p>
<p>Erin Robinson; Openscapes, Metadata Game Changers</p>
<p>Additional thanks to the entire <a href="https://nasa-openscapes.github.io/">NASA Earthdata Openscapes</a> community, Patrick Quinn at Element84, and to <a href="https://2i2c.org/">2i2c</a> for our Cloud infrastructure.</p>
</font><p><font size="5"></font></p>
</section>
<section id="tutorial-outline" class="slide level2">
<h2>Tutorial Outline</h2>
<p><font size="5"></font></p><font size="5">
<ol type="1">
<li>NASA Earthdata discovery and access in the cloud
<ul>
<li>Part 1: Explore Earthdata cloud data availablity</li>
<li>Part 2: Working with Cloud-Optimized GeoTIFFs using NASA’s CMR-STAC</li>
<li>Part 3: Working with Zarr-formatted data using NASA’s Harmony</li>
</ul></li>
<li>NASA Earthdata’s move to the cloud
<ul>
<li>Enabling Open Science via “Analysis-in-Place”</li>
<li>Resources for cloud adopters: NASA Earthdata Openscapes</li>
</ul></li>
</ol>
<p><strong><a href="https://github.com/NASA-Openscapes">NASA Openscapes Github</a></strong></p>
<ul>
<li>These slides: <a href="https://github.com/NASA-Openscapes/slides">github.com/NASA-Openscapes/slides</a></li>
<li>Cloud Hackathon book: <a href="https://nasa-openscapes.github.io/2021-Cloud-Workshop-AGU/">nasa-openscapes.github.io/2021-Cloud-Hackathon</a>
<p></p></li>
</ul>
</font><p><font size="5"></font></p>
</section>
<section id="nasa-earthdata-archive-growth" class="slide level2">
<h2>NASA Earthdata archive growth</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/EOSDIS-data-archive.png"></p>
<p></p><figcaption aria-hidden="true">EOSDIS Data Archive</figcaption><p></p>
</figure>
</div>
</section>
<section id="the-nasa-earthdata-cloud-evolution" class="slide level2">
<h2>The NASA Earthdata Cloud Evolution</h2>
<div>
<p><img src="images/EOSDIS-evolution.png" alt="Cloud Evolution" width="450"> <img src="images/EOSDIS-growth.png" alt="EOSDIS Archive Growth" width="450"></p>
</div>
<h5 id="nasa-distributed-active-archive-centers-daacs-are-continuing-to-migrate-data-to-the-earthdata-cloud">NASA Distributed Active Archive Centers (DAACs) are continuing to migrate data to the Earthdata Cloud</h5>
<p><font size="4"></font></p><font size="4">
<ul>
<li>Supporting increased data volume as new, high-resolution remote sensing missions launch in the coming years</li>
<li>Data hosted via Amazon Web Services, or AWS</li>
<li>DAACs continuing to support tools, services, and tutorial resources for our user communities</li>
</ul>
</font><p><font size="4"></font></p>
</section>
<section id="nasa-earthdata-cloud-discovery-and-access-w-open-source-tech" class="slide level2">
<h2>NASA Earthdata Cloud: Discovery and access w/ open source tech</h2>
<p><font size="4"></font></p><font size="4">
<p>The following tutorial demonstrates several basic end-to-end workflows to interact with data “in-place” from the NASA Earthdata Cloud, accessing Amazon Web Services (AWS) Single Storage Solution (S3) data locations without the need to download data. While the data can be downloaded locally, the cloud offers the ability to scale compute resources to perform analyses over large areas and time spans, which is critical as data volumes continue to grow.</p>
<p>Although the examples we’re working with in this notebook only focuses on a small time and area for demonstration purposes, this workflow can be modified and scaled up to suit a larger time range and region of interest.</p>
</font><p><font size="4"></font></p>
<h5 id="datasets-of-interest">Datasets of interest:</h5>
<p><font size="4"></font></p><font size="4">
<ul>
<li>Harmonized Landsat Sentinel-2 (HLS) Operational Land Imager Surface Reflectance and TOA Brightness Daily Global 30m v2.0 (L30) (<a href="https://doi.org/10.5067/HLS/HLSL30.002">10.5067/HLS/HLSL30.002</a>)
<ul>
<li>Surface reflectance (SR) and top of atmosphere (TOA) brightness data</li>
<li>Global observations of the land every 2–3 days at 30-meter (m)</li>
<li>Cloud Optimized GeoTIFF (COG) format</li>
</ul></li>
<li>ECCO Sea Surface Height - Daily Mean 0.5 Degree (Version 4 Release 4)(<a href="https://doi.org/10.5067/ECG5D-SSH44">10.5067/ECG5D-SSH44</a>).
<ul>
<li>Daily-averaged dynamic sea surface height</li>
<li>Time series of monthly NetCDFs on a 0.5-degree latitude/longitude grid.</li>
</ul></li>
</ul>
</font><p><font size="4"></font></p>
</section>
<section id="part-1-explore-earthdata-cloud" class="slide level2">
<h2>Part 1: Explore Earthdata Cloud</h2>
<h3 id="earthdata-search-demo"><a href="https://search.earthdata.nasa.gov">Earthdata Search</a> Demo</h3>
<p><img src="images/refine_ecco.png" alt="Select granules and click download" align="right" width="600px"></p>
<p><font size="3.5"></font></p><font size="3.5">
<p>The <strong>“Available from AWS Cloud”</strong> filter option returns all data from the NASA Earthdata Cloud, including the ECCO dataset, <a href="https://podaac.jpl.nasa.gov/datasetlist?search=ECCO">hosted by the PO.DAAC</a>. Here, we search for <code>ECCO monthly SSH</code> over the time period for the year 2015.</p>
</font><p><font size="3.5"></font></p>
<h5 id="view-and-select-data-access-options">View and Select Data Access Options</h5>
<p><font size="3.5"></font></p><font size="3.5">
<p>Clicking on the <em>ECCO Sea Surface Height - Monthly Mean 0.5 Degree (Version 4 Release 4)</em> dataset provides a list of files (granules) that are part of the dataset (collection). There we can select files to add to our project, with options to customize our download or access link(s).</p>
</font><p><font size="3.5"></font></p>
</section>
<section class="slide level2">

<h3 id="earthdata-search-access-options">Earthdata Search: Access Options</h3>
<p><img src="images/custom_download.png" align="right" alt="Customize your download or access" width="550px"></p>
<p><font size="5"></font></p><font size="5">
<p>Select the <strong>“Direct Download”</strong> option to view Access options via Direct Download and from the AWS Cloud. Additional options to customize the data are also available for this dataset.</p>
</font><p><font size="5"></font></p>
</section>
<section id="earthdata-cloud-access-information" class="slide level2">
<h2>Earthdata Cloud access information</h2>
<p><font size="4"></font></p><font size="4">
<p>The final ordering page provides instructions to download and links for data access in the cloud. The <em>AWS S3 Access</em> tab provides the <code>S3://</code> links, which is what we would use to access the data directly in-region (us-west-2) within the AWS cloud. E.g.: <code>s3://podaac-ops-cumulus-protected/ECCO_L4_SSH_05DEG_MONTHLY_V4R4/SEA_SURFACE_HEIGHT_mon_mean_2015-09_ECCO_V4r4_latlon_0p50deg.nc</code> where <code>s3</code> indicates data is stored in AWS S3 storage, <code>podaac-ops-cumulus-protected</code> is the <em>bucket</em>, and <code>ECCO_L4_SSH_05DEG_MONTHLY_V4R4</code> is the <em>object prefix</em> (the latter two are also listed in the dataset collection information under Cloud Access (step 3 above)).</p>
</font><p><font size="4"></font></p>
<p><img src="images/AWS_s3_access.png" alt="Direct S3 access" width="700"></p>
</section>
<section id="earthdata-cloud-access-information-1" class="slide level2">
<h2>Earthdata Cloud access information</h2>
<p><img src="images/AWS_s3_access.png" align="right" alt="Direct S3 access" width="600"></p>
<h4 id="integrate-file-links-into-programmatic-workflow-locally-or-in-the-aws-cloud.">Integrate file links into programmatic workflow, locally or in the AWS cloud.</h4>
<p><font size="4"></font></p><font size="4">
<p>We can connect these access links to subsequent data analysis in the cloud by either copy/pasting the <code>s3://</code> links or saving them as a text file to then access in a Jupyter notebook or script running in the cloud.</p>
</font><p><font size="4"></font></p>
</section>
<section class="slide level2">

<h3 id="part-2-working-with-cloud-optimized-geotiffs">Part 2: Working with Cloud-Optimized GeoTIFFs</h3>
<h4 id="using-nasas-common-metadata-repository-spatiotemporal-assett-catalog-cmr-stac">using NASA’s Common Metadata Repository SpatioTemporal Assett Catalog (CMR-STAC)</h4>
<p><font size="4"></font></p><font size="4">
<p>In this example we will access the NASA’s Harmonized Landsat Sentinel-2 (HLS) version 2 assets, which are archived in cloud optimized geoTIFF (COG) format archived by the Land Processes (LP) DAAC. The COGs can be used like any other GeoTIFF file, but have some added features that make them more efficient within the cloud data access paradigm. These features include: overviews and internal tiling.</p>
</font><p><font size="4"></font></p>
<h4 id="but-first-what-is-stac">But first, what is STAC?</h4>
<p><font size="4"></font></p><font size="4">
<ul>
<li><p><a href="https://stacspec.org/">SpatioTemporal Asset Catalog (STAC)</a> is a specification that provides a common language for interpreting geospatial information in order to standardize indexing and discovering data.</p></li>
<li><p>The <a href="https://stacspec.org/core.html">STAC specification</a> is made up of a collection of related, yet independent specifications that when used together provide search and discovery capabilities for remote assets.</p></li>
</ul>
</font><p><font size="4"></font></p>
</section>
<section class="slide level2">

<table>
<thead>
<tr class="header">
<th>Four STAC Specifications:</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://github.com/radiantearth/stac-spec/blob/master/catalog-spec/catalog-spec.md">STAC Catalog</a> (aka DAAC Archive)</td>
<td><a href="https://github.com/radiantearth/stac-spec/blob/master/collection-spec/collection-spec.md">STAC Collection</a> (aka Data Product)</td>
</tr>
<tr class="even">
<td><a href="https://github.com/radiantearth/stac-spec/blob/master/item-spec/item-spec.md">STAC Item</a> (aka Granule)</td>
<td><a href="https://github.com/radiantearth/stac-api-spec">STAC API</a></td>
</tr>
</tbody>
</table>
<p>
<br>
</p>
<h4 id="cmr-stac-api">CMR-STAC API</h4>
<p><font size="4.5"></font></p><font size="4.5">
<p>The <a href="https://github.com/nasa/cmr-stac">CMR-STAC</a> API is NASA’s implementation of the STAC API specification for all NASA data holdings within EOSDIS. The current implementation does not allow for querries accross the entire NASA catalog. Users must execute searches within provider catalogs (e.g., LPCLOUD) to find the STAC Items they are searching for. All the providers can be found at the CMR-STAC endpoint here: <a href="https://cmr.earthdata.nasa.gov/stac/" class="uri">https://cmr.earthdata.nasa.gov/stac/</a>.</p>
<p>In this example, we will query the <strong>LPCLOUD</strong> provider to identify STAC Items from the Harmonized Landsat Sentinel-2 (HLS) collection that fall within our region of interest (ROI) and within our specified time range.</p>
</font><p><font size="4.5"></font></p>
</section>
<section class="slide level2">

<h3 id="connect-to-the-cmr-stac-api">Connect to the CMR-STAC API:</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource python cell-code number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a>STAC_URL <span class="op">=</span> <span class="st">'https://cmr.earthdata.nasa.gov/stac'</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>provider_cat <span class="op">=</span> Client.<span class="bu">open</span>(STAC_URL)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<h4 id="and-the-land-processes-daac-lpcloud-providerstac-catalog">And the Land Processes DAAC <code>LPCLOUD</code> Provider/STAC Catalog:</h4>
<p><font size="5"></font></p><font size="5">
<p>For this next step we need the <code>provider title</code> (e.g., LPCLOUD). We will add the provider to the end of the CMR-STAC API URL (i.e., <code>https://cmr.earthdata.nasa.gov/stac/</code>) to connect to the LPCLOUD STAC Catalog.</p>
</font><p><font size="5"></font></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource python cell-code number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a>catalog <span class="op">=</span> Client.<span class="bu">open</span>(<span class="ss">f'</span><span class="sc">{</span>STAC_URL<span class="sc">}</span><span class="ss">/LPCLOUD/'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><font size="5"></font></p><font size="5">
<p>Since we are using a dedicated client (i.e., <code>pystac-client.Client</code>) to connect to our STAC Provider Catalog, we will have access to some useful internal methods and functions (e.g., <code>get_children()</code> or <code>get_all_items()</code>) we can use to get information from these objects.</p>
</font><p><font size="5"></font></p>
</section>
<section class="slide level2">

<h3 id="search-for-stac-items-read-in-a-geojson-file-and-plot">Search for STAC Items: Read in a geojson file and plot</h3>
<p><font size="4"></font></p><font size="4">
<p>We will define our ROI using a geojson file containing a small polygon feature in western Nebraska, USA. We’ll also specify the data collections and a time range for our example.</p>
<p>Read in a geojson file with geopandas and extract coodinates for our ROI. We can plot the polygon using the <code>geoviews</code> package that we imported as <code>gv</code> with ‘bokeh’ and ‘matplotlib’ extensions. The following has reasonable width, height, color, and line widths to view our polygon when it is overlayed on a base tile map.</p>
</font><p><font size="4"></font></p>
<div class="cell" data-execution_count="4">
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource python cell-code number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>field <span class="op">=</span> geopandas.read_file(<span class="st">'data/ne_w_agfields.geojson'</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>fieldShape <span class="op">=</span> field[<span class="st">'geometry'</span>][<span class="dv">0</span>]</span>
<span id="cb3-3"><a href="#cb3-3"></a>base <span class="op">=</span> gv.tile_sources.EsriImagery.opts(width<span class="op">=</span><span class="dv">650</span>, height<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb3-4"><a href="#cb3-4"></a>farmField <span class="op">=</span> gv.Polygons(fieldShape).opts(line_color<span class="op">=</span><span class="st">'yellow'</span>, line_width<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb3-5"><a href="#cb3-5"></a>base <span class="op">*</span> farmField</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<center>
<img src="images/field_outline.png" width="400px">
</center>
</section>
<section class="slide level2">

<h3 id="search-the-cmr-stac-api-with-our-search-criteria">Search the CMR-STAC API with our search criteria</h3>
<p><font size="5"></font></p><font size="5">
<p>Now we can put all our search criteria together using <code>catalog.search</code> from the <code>pystac_client</code> package. STAC Collection is synonomous with what we usually consider a NASA data product. Desired STAC Collections are submitted to the search API as a list containing the collection id. Let’s focus on S30 and L30 collections.</p>
</font><p><font size="5"></font></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource python cell-code number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>collections <span class="op">=</span> [<span class="st">'HLSL30.v2.0'</span>, <span class="st">'HLSS30.v2.0'</span>]</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a>date_range <span class="op">=</span> <span class="st">"2021-05/2021-08"</span></span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a>roi <span class="op">=</span> json.loads(field.to_json())[<span class="st">'features'</span>][<span class="dv">0</span>][<span class="st">'geometry'</span>]</span>
<span id="cb4-6"><a href="#cb4-6"></a></span>
<span id="cb4-7"><a href="#cb4-7"></a>search <span class="op">=</span> catalog.search(</span>
<span id="cb4-8"><a href="#cb4-8"></a>    collections<span class="op">=</span>collections,</span>
<span id="cb4-9"><a href="#cb4-9"></a>    intersects<span class="op">=</span>roi,</span>
<span id="cb4-10"><a href="#cb4-10"></a>    datetime<span class="op">=</span>date_range,</span>
<span id="cb4-11"><a href="#cb4-11"></a>    limit<span class="op">=</span><span class="dv">100</span></span>
<span id="cb4-12"><a href="#cb4-12"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<h3 id="view-stac-items-that-matched-our-search-query">View STAC Items that matched our search query</h3>
<div class="cell" data-execution_count="6">
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource python cell-code number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="bu">print</span>(<span class="st">'Matching STAC Items:'</span>, search.matched())</span>
<span id="cb5-2"><a href="#cb5-2"></a>item_collection <span class="op">=</span> search.get_all_items()</span>
<span id="cb5-3"><a href="#cb5-3"></a>item_collection[<span class="dv">0</span>].to_dict()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>Matching STAC Items: 113</code></pre>
</div>
<div class="cell-output-display" data-execution_count="6">
<pre><code>{'type': 'Feature',
 'stac_version': '1.0.0',
 'id': 'HLS.L30.T13TGF.2021124T173013.v2.0',
 'properties': {'datetime': '2021-05-04T17:30:13.428000Z',
  'start_datetime': '2021-05-04T17:30:13.428Z',
  'end_datetime': '2021-05-04T17:30:37.319Z',
  'eo:cloud_cover': 36},
 'geometry': {'type': 'Polygon',
  'coordinates': [[[-101.5423534, 40.5109845],
    [-101.3056118, 41.2066375],
    [-101.2894253, 41.4919436],
    [-102.6032964, 41.5268623],
    [-102.638891, 40.5386175],
    [-101.5423534, 40.5109845]]]},
 'links': [{'rel': 'self',
   'href': 'https://cmr.earthdata.nasa.gov/stac/LPCLOUD/collections/HLSL30.v2.0/items/HLS.L30.T13TGF.2021124T173013.v2.0'},
  {'rel': 'parent',
   'href': 'https://cmr.earthdata.nasa.gov/stac/LPCLOUD/collections/HLSL30.v2.0'},
  {'rel': 'collection',
   'href': 'https://cmr.earthdata.nasa.gov/stac/LPCLOUD/collections/HLSL30.v2.0'},
  {'rel': &lt;RelType.ROOT: 'root'&gt;,
   'href': 'https://cmr.earthdata.nasa.gov/stac/LPCLOUD/',
   'type': &lt;MediaType.JSON: 'application/json'&gt;,
   'title': 'LPCLOUD'},
  {'rel': 'provider', 'href': 'https://cmr.earthdata.nasa.gov/stac/LPCLOUD'},
  {'rel': 'via',
   'href': 'https://cmr.earthdata.nasa.gov/search/concepts/G2144020713-LPCLOUD.json'},
  {'rel': 'via',
   'href': 'https://cmr.earthdata.nasa.gov/search/concepts/G2144020713-LPCLOUD.umm_json'}],
 'assets': {'B11': {'href': 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021124T173013.v2.0/HLS.L30.T13TGF.2021124T173013.v2.0.B11.tif',
   'title': 'Download HLS.L30.T13TGF.2021124T173013.v2.0.B11.tif'},
  'B07': {'href': 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021124T173013.v2.0/HLS.L30.T13TGF.2021124T173013.v2.0.B07.tif',
   'title': 'Download HLS.L30.T13TGF.2021124T173013.v2.0.B07.tif'},
  'SAA': {'href': 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021124T173013.v2.0/HLS.L30.T13TGF.2021124T173013.v2.0.SAA.tif',
   'title': 'Download HLS.L30.T13TGF.2021124T173013.v2.0.SAA.tif'},
  'B06': {'href': 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021124T173013.v2.0/HLS.L30.T13TGF.2021124T173013.v2.0.B06.tif',
   'title': 'Download HLS.L30.T13TGF.2021124T173013.v2.0.B06.tif'},
  'B09': {'href': 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021124T173013.v2.0/HLS.L30.T13TGF.2021124T173013.v2.0.B09.tif',
   'title': 'Download HLS.L30.T13TGF.2021124T173013.v2.0.B09.tif'},
  'B10': {'href': 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021124T173013.v2.0/HLS.L30.T13TGF.2021124T173013.v2.0.B10.tif',
   'title': 'Download HLS.L30.T13TGF.2021124T173013.v2.0.B10.tif'},
  'VZA': {'href': 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021124T173013.v2.0/HLS.L30.T13TGF.2021124T173013.v2.0.VZA.tif',
   'title': 'Download HLS.L30.T13TGF.2021124T173013.v2.0.VZA.tif'},
  'SZA': {'href': 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021124T173013.v2.0/HLS.L30.T13TGF.2021124T173013.v2.0.SZA.tif',
   'title': 'Download HLS.L30.T13TGF.2021124T173013.v2.0.SZA.tif'},
  'B01': {'href': 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021124T173013.v2.0/HLS.L30.T13TGF.2021124T173013.v2.0.B01.tif',
   'title': 'Download HLS.L30.T13TGF.2021124T173013.v2.0.B01.tif'},
  'VAA': {'href': 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021124T173013.v2.0/HLS.L30.T13TGF.2021124T173013.v2.0.VAA.tif',
   'title': 'Download HLS.L30.T13TGF.2021124T173013.v2.0.VAA.tif'},
  'B05': {'href': 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021124T173013.v2.0/HLS.L30.T13TGF.2021124T173013.v2.0.B05.tif',
   'title': 'Download HLS.L30.T13TGF.2021124T173013.v2.0.B05.tif'},
  'B02': {'href': 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021124T173013.v2.0/HLS.L30.T13TGF.2021124T173013.v2.0.B02.tif',
   'title': 'Download HLS.L30.T13TGF.2021124T173013.v2.0.B02.tif'},
  'Fmask': {'href': 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021124T173013.v2.0/HLS.L30.T13TGF.2021124T173013.v2.0.Fmask.tif',
   'title': 'Download HLS.L30.T13TGF.2021124T173013.v2.0.Fmask.tif'},
  'B03': {'href': 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021124T173013.v2.0/HLS.L30.T13TGF.2021124T173013.v2.0.B03.tif',
   'title': 'Download HLS.L30.T13TGF.2021124T173013.v2.0.B03.tif'},
  'B04': {'href': 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021124T173013.v2.0/HLS.L30.T13TGF.2021124T173013.v2.0.B04.tif',
   'title': 'Download HLS.L30.T13TGF.2021124T173013.v2.0.B04.tif'},
  'browse': {'href': 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/HLSL30.020/HLS.L30.T13TGF.2021124T173013.v2.0/HLS.L30.T13TGF.2021124T173013.v2.0.jpg',
   'type': 'image/jpeg',
   'title': 'Download HLS.L30.T13TGF.2021124T173013.v2.0.jpg'},
  'metadata': {'href': 'https://cmr.earthdata.nasa.gov/search/concepts/G2144020713-LPCLOUD.xml',
   'type': 'application/xml'}},
 'bbox': [-102.638891, 40.510984, -101.289425, 41.526862],
 'stac_extensions': ['https://stac-extensions.github.io/eo/v1.0.0/schema.json'],
 'collection': 'HLSL30.v2.0'}</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="filtering-stac-items">Filtering STAC Items</h3>
<p><font size="4"></font></p><font size="4">
<p>Below we will loop through and filter the item_collection by a specified cloud cover as well as extract the band we’d need to do an Enhanced Vegetation Index (EVI) calculation for a future analysis. We will also specify the STAC Assets (i.e., bands/layers) of interest for both the S30 and L30 collections (also in our collections variable above) and print out the first ten links, converted to s3 locations:</p>
</font><p><font size="4"></font></p>
<div class="cell" data-execution_count="7">
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource python cell-code number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a>cloudcover <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a>s30_bands <span class="op">=</span> [<span class="st">'B8A'</span>, <span class="st">'B04'</span>, <span class="st">'B02'</span>, <span class="st">'Fmask'</span>]    <span class="co"># S30 bands for EVI calculation and quality filtering -&gt; NIR, RED, BLUE, Quality </span></span>
<span id="cb8-4"><a href="#cb8-4"></a>l30_bands <span class="op">=</span> [<span class="st">'B05'</span>, <span class="st">'B04'</span>, <span class="st">'B02'</span>, <span class="st">'Fmask'</span>]    <span class="co"># L30 bands for EVI calculation and quality filtering -&gt; NIR, RED, BLUE, Quality </span></span>
<span id="cb8-5"><a href="#cb8-5"></a></span>
<span id="cb8-6"><a href="#cb8-6"></a>evi_band_links <span class="op">=</span> []</span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="cf">for</span> i <span class="kw">in</span> item_collection:</span>
<span id="cb8-9"><a href="#cb8-9"></a>    <span class="cf">if</span> i.properties[<span class="st">'eo:cloud_cover'</span>] <span class="op">&lt;=</span> cloudcover:</span>
<span id="cb8-10"><a href="#cb8-10"></a>        <span class="cf">if</span> i.collection_id <span class="op">==</span> <span class="st">'HLSS30.v2.0'</span>:</span>
<span id="cb8-11"><a href="#cb8-11"></a>            <span class="co">#print(i.properties['eo:cloud_cover'])</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>            evi_bands <span class="op">=</span> s30_bands</span>
<span id="cb8-13"><a href="#cb8-13"></a>        <span class="cf">elif</span> i.collection_id <span class="op">==</span> <span class="st">'HLSL30.v2.0'</span>:</span>
<span id="cb8-14"><a href="#cb8-14"></a>            <span class="co">#print(i.properties['eo:cloud_cover'])</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>            evi_bands <span class="op">=</span> l30_bands</span>
<span id="cb8-16"><a href="#cb8-16"></a></span>
<span id="cb8-17"><a href="#cb8-17"></a>        <span class="cf">for</span> a <span class="kw">in</span> i.assets:</span>
<span id="cb8-18"><a href="#cb8-18"></a>            <span class="cf">if</span> <span class="bu">any</span>(b<span class="op">==</span>a <span class="cf">for</span> b <span class="kw">in</span> evi_bands):</span>
<span id="cb8-19"><a href="#cb8-19"></a>                evi_band_links.append(i.assets[a].href)</span>
<span id="cb8-20"><a href="#cb8-20"></a>                </span>
<span id="cb8-21"><a href="#cb8-21"></a>s3_links <span class="op">=</span> [l.replace(<span class="st">'https://data.lpdaac.earthdatacloud.nasa.gov/'</span>, <span class="st">'s3://'</span>) <span class="cf">for</span> l <span class="kw">in</span> evi_band_links]</span>
<span id="cb8-22"><a href="#cb8-22"></a>s3_links[:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<h3 id="filtering-stac-items-1">Filtering STAC Items</h3>
<p><font size="4"></font></p><font size="4">
<p>Below we will loop through and filter the item_collection by a specified cloud cover as well as extract the band we’d need to do an Enhanced Vegetation Index (EVI) calculation for a future analysis. We will also specify the STAC Assets (i.e., bands/layers) of interest for both the S30 and L30 collections (also in our collections variable above) and print out the first ten links, converted to s3 locations:</p>
</font><p><font size="4"></font></p>
<div class="cell" data-execution_count="54">
<div class="cell-output-display" data-execution_count="54">
<pre><code>['s3://lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021133T172406.v2.0/HLS.L30.T13TGF.2021133T172406.v2.0.B04.tif',
 's3://lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021133T172406.v2.0/HLS.L30.T13TGF.2021133T172406.v2.0.B05.tif',
 's3://lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021133T172406.v2.0/HLS.L30.T13TGF.2021133T172406.v2.0.Fmask.tif',
 's3://lp-prod-protected/HLSL30.020/HLS.L30.T13TGF.2021133T172406.v2.0/HLS.L30.T13TGF.2021133T172406.v2.0.B02.tif',
 's3://lp-prod-protected/HLSL30.020/HLS.L30.T14TKL.2021133T172406.v2.0/HLS.L30.T14TKL.2021133T172406.v2.0.B02.tif',
 's3://lp-prod-protected/HLSL30.020/HLS.L30.T14TKL.2021133T172406.v2.0/HLS.L30.T14TKL.2021133T172406.v2.0.B04.tif',
 's3://lp-prod-protected/HLSL30.020/HLS.L30.T14TKL.2021133T172406.v2.0/HLS.L30.T14TKL.2021133T172406.v2.0.B05.tif',
 's3://lp-prod-protected/HLSL30.020/HLS.L30.T14TKL.2021133T172406.v2.0/HLS.L30.T14TKL.2021133T172406.v2.0.Fmask.tif',
 's3://lp-prod-protected/HLSS30.020/HLS.S30.T14TKL.2021133T173859.v2.0/HLS.S30.T14TKL.2021133T173859.v2.0.B04.tif',
 's3://lp-prod-protected/HLSS30.020/HLS.S30.T14TKL.2021133T173859.v2.0/HLS.S30.T14TKL.2021133T173859.v2.0.B8A.tif']</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="access-s3-storage-location">Access s3 storage location</h3>
<p><font size="4"></font></p><font size="4">
<p>Access s3 credentials from LP.DAAC and create a boto3 Session object using your temporary credentials. This Session is used to pass credentials and configuration to AWS so we can interact wit S3 objects from applicable buckets.</p>
</font><p><font size="4"></font></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource python cell-code number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>s3_cred_endpoint <span class="op">=</span> <span class="st">'https://data.lpdaac.earthdatacloud.nasa.gov/s3credentials'</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>temp_creds_req <span class="op">=</span> requests.get(s3_cred_endpoint).json()</span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a>session <span class="op">=</span> boto3.Session(aws_access_key_id<span class="op">=</span>temp_creds_req[<span class="st">'accessKeyId'</span>], </span>
<span id="cb10-5"><a href="#cb10-5"></a>                        aws_secret_access_key<span class="op">=</span>temp_creds_req[<span class="st">'secretAccessKey'</span>],</span>
<span id="cb10-6"><a href="#cb10-6"></a>                        aws_session_token<span class="op">=</span>temp_creds_req[<span class="st">'sessionToken'</span>],</span>
<span id="cb10-7"><a href="#cb10-7"></a>                        region_name<span class="op">=</span><span class="st">'us-west-2'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<h4 id="gdal-configurations">GDAL Configurations</h4>
<p><font size="3"></font></p><font size="3">
<p>GDAL is a foundational piece of geospatial software that is leveraged by several popular open-source, and closed, geospatial software. The rasterio package is no exception. Rasterio leverages GDAL to, among other things, read and write raster data files, e.g., GeoTIFFs/Cloud Optimized GeoTIFFs. To read remote files, i.e., files/objects stored in the cloud, GDAL uses its Virtual File System API. In a perfect world, one would be able to point a Virtual File System (there are several) at a remote data asset and have the asset retrieved, but that is not always the case. GDAL has a host of configurations/environmental variables that adjust its behavior to, for example, make a request more performant or to pass AWS credentials to the distribution system. Below, we’ll identify the evironmental variables that will help us get our data from cloud.</p>
</font><p><font size="3"></font></p>
<div class="cell" data-execution_count="9">
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource python cell-code number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>rio_env <span class="op">=</span> rio.Env(AWSSession(session),</span>
<span id="cb11-2"><a href="#cb11-2"></a>                  GDAL_DISABLE_READDIR_ON_OPEN<span class="op">=</span><span class="st">'TRUE'</span>,</span>
<span id="cb11-3"><a href="#cb11-3"></a>                  GDAL_HTTP_COOKIEFILE<span class="op">=</span>os.path.expanduser(<span class="st">'~/cookies.txt'</span>),</span>
<span id="cb11-4"><a href="#cb11-4"></a>                  GDAL_HTTP_COOKIEJAR<span class="op">=</span>os.path.expanduser(<span class="st">'~/cookies.txt'</span>))</span>
<span id="cb11-5"><a href="#cb11-5"></a>rio_env.<span class="fu">__enter__</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="9">
<pre><code>&lt;rasterio.env.Env at 0x7fabb55653d0&gt;</code></pre>
</div>
</div>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource python cell-code number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a>s3_url <span class="op">=</span> <span class="st">'s3://lp-prod-protected/HLSL30.020/HLS.L30.T11SQA.2021333T181532.v2.0/HLS.L30.T11SQA.2021333T181532.v2.0.B04.tif'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<h3 id="read-cloud-optimized-geotiff-into-rioxarray">Read Cloud-Optimized GeoTIFF into <code>rioxarray</code></h3>
<div class="cell" data-execution_count="11">
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource python cell-code number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a>da <span class="op">=</span> rioxarray.open_rasterio(s3_url)</span>
<span id="cb14-2"><a href="#cb14-2"></a>da_red <span class="op">=</span> da.squeeze(<span class="st">'band'</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-3"><a href="#cb14-3"></a>da_red</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<center>
<img src="images/rioxarray-out.png" width="750px">
</center>
</section>
<section id="plot-using-hvplot" class="slide level2">
<h2>Plot using <code>hvplot</code></h2>
<div class="cell" data-execution_count="12">
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource python cell-code number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a>da_red.hvplot.image(x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, cmap<span class="op">=</span><span class="st">'gray'</span>, aspect<span class="op">=</span><span class="st">'equal'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<center>
<img src="images/bokeh_plot_HLS.png" width="700px">
</center>
</section>
<section class="slide level2">

<h3 id="part-3-working-with-zarr-formatted-data">Part 3: Working with Zarr-formatted data</h3>
<h4 id="using-nasas-harmony-cloud-transformation-service">using NASA’s Harmony cloud transformation service</h4>
<p><font size="5"></font></p><font size="5">
<p>We have already explored direct access to the NASA EOSDIS archive in the cloud via the Amazon Simple Storage Service (S3). In addition to directly accessing the files archived and distributed by each of the NASA DAACs, many datasets also support services that allow us to customize the data via subsetting, reformatting, reprojection, and other transformations.</p>
<p>This example demonstrates “analysis in place” using customized ECCO Level 4 monthly sea surface height data, in this case reformatted to Zarr, from a new ecosystem of services operating within the NASA Earthdata Cloud: <a href="https://harmony.earthdata.nasa.gov/">NASA Harmony</a>:</p>
<ul>
<li>Consistent access patterns to EOSDIS holdings make cross-data center data access easier</li>
<li>Data reduction services allow us to request only the data we want, in the format and projection we want</li>
<li>Analysis Ready Data and cloud access will help reduce time-to-science</li>
<li>Community Development helps reduce the barriers for re-use of code and sharing of domain knowledge</li>
</ul>
</font><p><font size="5"></font></p>
</section>
<section class="slide level2">

<h3 id="using-harmony-py-to-customize-data">Using Harmony-Py to customize data</h3>
<p><font size="5"></font></p><font size="5">
<p>Harmony-Py provides a pip installable Python alternative to directly using Harmony’s RESTful API to make it easier to request data and service options, especially when interacting within a Python Jupyter Notebook environment.</p>
</font><p><font size="5"></font></p>
<h4 id="create-harmony-client-object">Create Harmony Client object</h4>
<p><font size="5"></font></p><font size="5">
<p>First, we need to create a Harmony Client, which is what we will interact with to submit and inspect a data request to Harmony, as well as to retrieve results.</p>
</font><p><font size="5"></font></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource python cell-code number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>harmony_client <span class="op">=</span> Client()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<h3 id="create-harmony-request">Create Harmony Request</h3>
<p><font size="5"><strong>Specify a temporal range over 2015, and Zarr as an output format.</strong></font></p>
<p><font size="5"><em>What is Zarr?</em></font></p>
<p><font size="4"></font></p><font size="4">
<p>Zarr is an open source library for storing N-dimensional array data. It supports multidimensional arrays with attributes and dimensions similar to NetCDF4, and it can be read by XArray. Zarr is often used for data held in cloud object storage (like Amazon S3), because it is better optimized for these situations than NetCDF4.</p>
</font><p><font size="4"></font></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource python cell-code number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a>short_name <span class="op">=</span> <span class="st">'ECCO_L4_SSH_05DEG_MONTHLY_V4R4'</span></span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a>request <span class="op">=</span> Request(</span>
<span id="cb17-4"><a href="#cb17-4"></a>    collection<span class="op">=</span>Collection(<span class="bu">id</span><span class="op">=</span>short_name),</span>
<span id="cb17-5"><a href="#cb17-5"></a>    temporal<span class="op">=</span>{</span>
<span id="cb17-6"><a href="#cb17-6"></a>        <span class="st">'start'</span>: dt.datetime(<span class="dv">2015</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb17-7"><a href="#cb17-7"></a>        <span class="st">'stop'</span>: dt.datetime(<span class="dv">2015</span>, <span class="dv">12</span>, <span class="dv">31</span>),</span>
<span id="cb17-8"><a href="#cb17-8"></a>    },</span>
<span id="cb17-9"><a href="#cb17-9"></a>    <span class="bu">format</span><span class="op">=</span><span class="st">'application/x-zarr'</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>)</span>
<span id="cb17-11"><a href="#cb17-11"></a></span>
<span id="cb17-12"><a href="#cb17-12"></a>job_id <span class="op">=</span> harmony_client.submit(request)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<h3 id="check-request-status-and-view-output-urls">Check request status and view output URLs</h3>
<p><font size="5"></font></p><font size="5">
<p>Harmony data outputs can be accessed within the cloud using the s3 URLs and AWS credentials provided in the Harmony job response:</p>
</font><p><font size="5"></font></p>
<div class="cell" data-execution_count="17">
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource python cell-code number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a>harmony_client.wait_for_processing(job_id, show_progress<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a>results <span class="op">=</span> harmony_client.result_urls(job_id, link_type<span class="op">=</span>LinkType.s3)</span>
<span id="cb18-4"><a href="#cb18-4"></a>s3_urls <span class="op">=</span> <span class="bu">list</span>(results)</span>
<span id="cb18-5"><a href="#cb18-5"></a>s3_urls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="17">
<pre><code>['s3://harmony-prod-staging/public/harmony/netcdf-to-zarr/0bfeca8d-8aa7-4dc0-920c-92491d91dd55/SEA_SURFACE_HEIGHT_mon_mean_2015-01_ECCO_V4r4_latlon_0p50deg.zarr',
 's3://harmony-prod-staging/public/harmony/netcdf-to-zarr/0bfeca8d-8aa7-4dc0-920c-92491d91dd55/SEA_SURFACE_HEIGHT_mon_mean_2015-02_ECCO_V4r4_latlon_0p50deg.zarr',
 's3://harmony-prod-staging/public/harmony/netcdf-to-zarr/0bfeca8d-8aa7-4dc0-920c-92491d91dd55/SEA_SURFACE_HEIGHT_mon_mean_2015-12_ECCO_V4r4_latlon_0p50deg.zarr',
 's3://harmony-prod-staging/public/harmony/netcdf-to-zarr/0bfeca8d-8aa7-4dc0-920c-92491d91dd55/SEA_SURFACE_HEIGHT_mon_mean_2015-11_ECCO_V4r4_latlon_0p50deg.zarr',
 's3://harmony-prod-staging/public/harmony/netcdf-to-zarr/0bfeca8d-8aa7-4dc0-920c-92491d91dd55/SEA_SURFACE_HEIGHT_mon_mean_2015-03_ECCO_V4r4_latlon_0p50deg.zarr',
 's3://harmony-prod-staging/public/harmony/netcdf-to-zarr/0bfeca8d-8aa7-4dc0-920c-92491d91dd55/SEA_SURFACE_HEIGHT_mon_mean_2015-04_ECCO_V4r4_latlon_0p50deg.zarr',
 's3://harmony-prod-staging/public/harmony/netcdf-to-zarr/0bfeca8d-8aa7-4dc0-920c-92491d91dd55/SEA_SURFACE_HEIGHT_mon_mean_2015-06_ECCO_V4r4_latlon_0p50deg.zarr',
 's3://harmony-prod-staging/public/harmony/netcdf-to-zarr/0bfeca8d-8aa7-4dc0-920c-92491d91dd55/SEA_SURFACE_HEIGHT_mon_mean_2015-05_ECCO_V4r4_latlon_0p50deg.zarr',
 's3://harmony-prod-staging/public/harmony/netcdf-to-zarr/0bfeca8d-8aa7-4dc0-920c-92491d91dd55/SEA_SURFACE_HEIGHT_mon_mean_2015-07_ECCO_V4r4_latlon_0p50deg.zarr',
 's3://harmony-prod-staging/public/harmony/netcdf-to-zarr/0bfeca8d-8aa7-4dc0-920c-92491d91dd55/SEA_SURFACE_HEIGHT_mon_mean_2015-08_ECCO_V4r4_latlon_0p50deg.zarr',
 's3://harmony-prod-staging/public/harmony/netcdf-to-zarr/0bfeca8d-8aa7-4dc0-920c-92491d91dd55/SEA_SURFACE_HEIGHT_mon_mean_2015-09_ECCO_V4r4_latlon_0p50deg.zarr',
 's3://harmony-prod-staging/public/harmony/netcdf-to-zarr/0bfeca8d-8aa7-4dc0-920c-92491d91dd55/SEA_SURFACE_HEIGHT_mon_mean_2015-10_ECCO_V4r4_latlon_0p50deg.zarr']</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="open-staged-files-with-s3fs-and-xarray">Open staged files with <em>s3fs</em> and <em>xarray</em></h3>
<p><font size="5"></font></p><font size="5">
<p>Access AWS credentials for the Harmony bucket, and use the AWS <code>s3fs</code> package to create a file system that can then be read by xarray. Below we create session by passing in the temporary credentials we recieved from our temporary credentials endpoint.</p>
</font><p><font size="5"></font></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource python cell-code number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>creds <span class="op">=</span> harmony_client.aws_credentials()</span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a>s3_fs <span class="op">=</span> s3fs.S3FileSystem(</span>
<span id="cb20-4"><a href="#cb20-4"></a>    key<span class="op">=</span>creds[<span class="st">'aws_access_key_id'</span>],</span>
<span id="cb20-5"><a href="#cb20-5"></a>    secret<span class="op">=</span>creds[<span class="st">'aws_secret_access_key'</span>],</span>
<span id="cb20-6"><a href="#cb20-6"></a>    token<span class="op">=</span>creds[<span class="st">'aws_session_token'</span>],</span>
<span id="cb20-7"><a href="#cb20-7"></a>    client_kwargs<span class="op">=</span>{<span class="st">'region_name'</span>:<span class="st">'us-west-2'</span>},</span>
<span id="cb20-8"><a href="#cb20-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<h3 id="open-staged-files-with-s3fs-and-xarray-1">Open staged files with <em>s3fs</em> and <em>xarray</em></h3>
<p><font size="5"></font></p><font size="5">
<p>Open the Zarr stores using the s3fs package, then load them all at once into a concatenated xarray dataset:</p>
</font><p><font size="5"></font></p>
<div class="cell" data-execution_count="58">
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource python cell-code number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a>stores <span class="op">=</span> [s3fs.S3Map(root<span class="op">=</span>url, s3<span class="op">=</span>s3_fs, check<span class="op">=</span><span class="va">False</span>) <span class="cf">for</span> url <span class="kw">in</span> s3_urls]</span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="kw">def</span> open_zarr_xarray(store):</span>
<span id="cb21-3"><a href="#cb21-3"></a>    <span class="cf">return</span> xr.open_zarr(store<span class="op">=</span>store, consolidated<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a>datasets <span class="op">=</span> pqdm(stores, open_zarr_xarray, n_jobs<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb21-6"><a href="#cb21-6"></a></span>
<span id="cb21-7"><a href="#cb21-7"></a>ds <span class="op">=</span> xr.concat(datasets, <span class="st">'time'</span>, coords<span class="op">=</span><span class="st">'minimal'</span>, )</span>
<span id="cb21-8"><a href="#cb21-8"></a>ds <span class="op">=</span> xr.decode_cf(ds, mask_and_scale<span class="op">=</span><span class="va">True</span>, decode_coords<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-9"><a href="#cb21-9"></a>ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/harmony-out.png" width="400px"></p>
</section>
<section class="slide level2">

<h3 id="plot-the-sea-surface-height-time-series-using-hvplot">Plot the Sea Surface Height time series using <code>hvplot</code></h3>
<p><font size="4"></font></p><font size="4">
<p>Now we can start looking at aggregations across the time dimension. In this case, plot the standard deviation of the temperature at each point to get a visual sense of how much temperatures fluctuate over the course of the month.</p>
</font><p><font size="4"></font></p>
<div class="cell" data-execution_count="52">
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource python cell-code number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a>ssh_da <span class="op">=</span> ds.SSH</span>
<span id="cb22-2"><a href="#cb22-2"></a>ssh_da <span class="op">=</span> ssh_da.where(ssh_da <span class="op">&lt;</span> <span class="dv">9</span>) <span class="co">#apply land mask value</span></span>
<span id="cb22-3"><a href="#cb22-3"></a></span>
<span id="cb22-4"><a href="#cb22-4"></a>stdev_ssh <span class="op">=</span> ssh_da.std(<span class="st">'time'</span>)</span>
<span id="cb22-5"><a href="#cb22-5"></a>stdev_ssh.name <span class="op">=</span> <span class="st">'stdev of analysed_sst [Kelvin]'</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>stdev_ssh.plot()<span class="op">;</span></span>
<span id="cb22-7"><a href="#cb22-7"></a></span>
<span id="cb22-8"><a href="#cb22-8"></a>ssh_da.hvplot.image(x<span class="op">=</span><span class="st">'longitude'</span>, y<span class="op">=</span><span class="st">'latitude'</span>, cmap<span class="op">=</span><span class="st">'Spectral_r'</span>, aspect<span class="op">=</span><span class="st">'equal'</span>).opts(clim<span class="op">=</span>(ssh_da.attrs[<span class="st">'valid_min'</span>],ssh_da.attrs[<span class="st">'valid_max'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<center>
<img src="images/bokeh_plot_ECCO.png" width="700px">
</center>
</section>
<section class="slide level2">

<h3 id="data-and-analysis-co-located-in-place">Data and Analysis co-located “in place”</h3>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/Cloud_ecosystem_diagram.png"></p>
<p></p><figcaption aria-hidden="true">Earthdata Cloud Paradigm</figcaption><p></p>
</figure>
</div>
</section>
<section id="nasa-earthdata-cloud-as-an-enabler-of-open-science" class="slide level2">
<h2>NASA Earthdata Cloud as an enabler of Open Science</h2>
<p><img src="images/open-data.png" align="right" alt="Direct S3 access" width="400px"></p>
<p><font size="5"></font></p><font size="5">
<p>*Reducing barriers to large-scale scientific research in the era of “big data”</p>
<p>*Increasing community contributions with hands-on engagement</p>
<p>*Promoting reproducible and shareable workflows without relying on local storage systems</p>
</font><p><font size="5"></font></p>
</section>
<section id="building-nasa-earthdata-cloud-resources" class="slide level2">
<h2>Building NASA Earthdata Cloud Resources</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/openscapes-tutorials.png"></p>
<p></p><figcaption aria-hidden="true">Openscapes Tutorials</figcaption><p></p>
</figure>
</div>
</section>
<section id="a-growing-list-of-resources" class="slide level2">
<h2>A Growing List of Resources!</h2>
<p><font size="5"></font></p><font size="5">
<ul>
<li><p><a href="https://nasa-openscapes.github.io/2021-Cloud-Hackathon/">NASA Earthdata 2021 Cloud Hackathon</a></p></li>
<li><p><a href="https://nasa-openscapes.github.io/2021-Cloud-Workshop-AGU/">NASA Earthdata Workshop</a></p></li>
<li><p><a href="https://earthdata.nasa.gov/learn/user-resources/webinars-and-tutorials/cloud-primer">NASA Earthdata Cloud Primer</a> -AWS cloud primer: helpful tutorials for how to set up your own EC2 cloud instance in AWS, attach storeage, move files back and forth, and more.</p></li>
<li><p><a href="https://github.com/eeholmes/jupyterhub">Setting up a JupyterHub on AWS</a> - Earthdata Cloud Hackathon participant’s repo replicating our shared compute environment to access and analyze Earthdata “in place”</p></li>
<li><p><a href="https://github.com/NASA-Openscapes/corn">NASA Workshop Environment</a></p></li>
<li><p><a href="https://earthdata.nasa.gov/learn/user-resources/webinars-and-tutorials/how-to-cloud-for-earth-scientists">NASA Earthdata: How to Cloud</a></p></li>
<li><p><a href="https://www.usgs.gov/centers/eros/science/eyes-earth-episode-58-satellites-and-cloud-computing?qt-science_center_objects=0#qt-science_center_objects">USGS Eyes on Earth Podcast: Satellites and Cloud Computing</a> - with Aaron Friesz (LP DAAC!)</p></li>
<li><p><a href="https://lpdaac.usgs.gov/resources/e-learning/">LP DAAC e-Learning</a></p></li>
<li><p><a href="https://podaac.jpl.nasa.gov/cloud-datasets/about">PO.DAAC Cloud Data Page</a></p></li>
<li><p><a href="https://podaac.jpl.nasa.gov/animations/Webinar_Surfing_Ocean_Data_in_the_Cloud_Beginners_Guide_PO.DAAC_NASA_Earthdata_Cloud">PO.DAAC Earthdata Webinar (Aug 2021): Surfing Ocean Data in the Cloud - The Beginner’s Guide to PO.DAAC in the NASA Earthdata Cloud</a></p></li>
<li><p><a href="https://github.com/podaac">PO.DAAC Github Repository</a></p></li>
</ul>
</font><p><font size="5"></font></p>
<div class="footer footer-default">

</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="Earthdata_Cloud__Open-Science-Tutorial_files/libs/revealjs/dist/reveal.js"></script>

  <!-- reveal.js plugins -->
  <script src="Earthdata_Cloud__Open-Science-Tutorial_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="Earthdata_Cloud__Open-Science-Tutorial_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="Earthdata_Cloud__Open-Science-Tutorial_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="Earthdata_Cloud__Open-Science-Tutorial_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="Earthdata_Cloud__Open-Science-Tutorial_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  <script src="Earthdata_Cloud__Open-Science-Tutorial_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="Earthdata_Cloud__Open-Science-Tutorial_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="Earthdata_Cloud__Open-Science-Tutorial_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="Earthdata_Cloud__Open-Science-Tutorial_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>


  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,

'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,

        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        setTimeout(function() {
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          let href = ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const cites = ref.parentNode.getAttribute('data-cites').split(' ');
        tippyHover(ref, function() {
          var popup = window.document.createElement('div');
          cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    });
    </script>
    

<div class="reveal-references"></div></body></html>